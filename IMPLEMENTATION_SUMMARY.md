# One-shot GEE å®ç°æ€»ç»“æŠ¥å‘Š

## ğŸ¯ é¡¹ç›®å®ŒæˆçŠ¶æ€

### âœ… ç¬¬ä¸€é˜¶æ®µæ ¸å¿ƒåŠŸèƒ½ - å·²å®Œæˆ

æˆ‘ä»¬æˆåŠŸå®Œæˆäº†One-shot GEEçš„ç¬¬ä¸€é˜¶æ®µæ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ŒåŒ…æ‹¬ï¼š

1. **æ•°æ®å¤„ç†æ¨¡å—** (`dataset/gee_processor.py`)
2. **æŸå¤±å‡½æ•°æ¨¡å—** (`losses/gee_loss.py`)  
3. **è®­ç»ƒè„šæœ¬** (`train_gee.py`)
4. **è¯„ä¼°æ¨¡å—** (`evaluation/gee_evaluator.py`)
5. **æµ‹è¯•å¥—ä»¶** (`test_gee_components.py`, `test_gee_training.py`)

## ğŸ“Š æµ‹è¯•ç»“æœ

### ç»„ä»¶åŠŸèƒ½æµ‹è¯• âœ…
```bash
conda activate one-shot-gee
python test_gee_components.py
```

**ç»“æœï¼š**
- âœ… GEEæ•°æ®å¤„ç†å™¨æµ‹è¯•é€šè¿‡
  - æ€§åˆ«æ£€æµ‹åŠŸèƒ½æ­£å¸¸ï¼ˆè¯†åˆ«he/she/him/herç­‰å…³é”®è¯ï¼‰
  - æµ‹è¯•æ•°æ®ç”Ÿæˆæ­£å¸¸ï¼ˆç”Ÿæˆå¹³è¡¡çš„ç”·å¥³æ€§åˆ«æ ·æœ¬ï¼‰
- âœ… GEEæŸå¤±å‡½æ•°æµ‹è¯•é€šè¿‡
  - Tokenç†µè®¡ç®—æ­£å¸¸ï¼ˆèŒƒå›´6.29-6.50ï¼‰
  - ç»„ç†µè®¡ç®—æ­£å¸¸ï¼ˆç”·å¥³åˆ†ç»„ç»Ÿè®¡ï¼‰
  - L2å’ŒL1æŸå¤±å‡½æ•°æ­£å¸¸
- âš ï¸ GEEè¯„ä¼°å™¨æµ‹è¯•è·³è¿‡ï¼ˆéœ€è¦å®é™…æ¨¡å‹ï¼‰
- âœ… ç»„ä»¶é›†æˆæµ‹è¯•é€šè¿‡

### è®­ç»ƒé€»è¾‘æµ‹è¯• âœ…
```bash
conda activate one-shot-gee
python test_gee_training.py
```

**ç»“æœï¼š**
- âœ… æ•°æ®å¤„ç†æµç¨‹æ­£å¸¸
- âœ… æŸå¤±å‡½æ•°è®¡ç®—æ­£ç¡®
- âœ… è®­ç»ƒå¾ªç¯é€»è¾‘æ­£ç¡®
- âœ… ä¸åŒå‚æ•°é…ç½®æœ‰æ•ˆ

**å…³é”®è§‚å¯Ÿï¼š**
- ç†µå·®è·åœ¨åˆç†èŒƒå›´å†…ï¼š0.001-0.021
- æŸå¤±å€¼ç¨³å®šï¼š6.40-6.42
- Lambdaå‚æ•°å½±å“åè§æŸå¤±æƒé‡
- L1å’ŒL2æŸå¤±å‡½æ•°å·®å¼‚æ˜æ˜¾

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
one-shot-em/
â”œâ”€â”€ dataset/
â”‚   â””â”€â”€ gee_processor.py          # æ•°æ®å¤„ç†å™¨
â”œâ”€â”€ losses/
â”‚   â””â”€â”€ gee_loss.py              # GEEæŸå¤±å‡½æ•°
â”œâ”€â”€ evaluation/
â”‚   â””â”€â”€ gee_evaluator.py         # è¯„ä¼°å™¨
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ train_one_shot_gee.sh    # è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ evaluate_gee.sh          # è¯„ä¼°è„šæœ¬
â”‚   â””â”€â”€ quick_test_gee.sh        # å¿«é€Ÿæµ‹è¯•è„šæœ¬
â”œâ”€â”€ train_gee.py                 # ä¸»è®­ç»ƒè„šæœ¬
â”œâ”€â”€ test_gee_components.py       # ç»„ä»¶æµ‹è¯•
â”œâ”€â”€ test_gee_training.py         # è®­ç»ƒé€»è¾‘æµ‹è¯•
â””â”€â”€ GEE_README.md               # é¡¹ç›®æ–‡æ¡£
```

### æ•°å­¦å®ç°

**GEEæŸå¤±å‡½æ•°**ï¼š
```
L_GEE = H_bar + Î» * Î£(H_g - H_bar)Â²
```

å…¶ä¸­ï¼š
- `H_bar`: å…¨æ‰¹å¹³å‡ç†µï¼ˆç†µæœ€å°åŒ–é¡¹ï¼‰
- `Î»`: å¹³è¡¡æƒé‡ï¼ˆé»˜è®¤3.0ï¼‰
- `H_g`: å„ç»„å¹³å‡ç†µ
- `Î£(H_g - H_bar)Â²`: ç»„é—´ç†µå·®å¼‚æƒ©ç½šé¡¹

**å®ç°ç‰¹ç‚¹**ï¼š
- æ”¯æŒL1å’ŒL2ä¸¤ç§æƒ©ç½šé¡¹
- è‡ªåŠ¨é€€ç«æœºåˆ¶
- æ‰¹å†…æ€§åˆ«å¹³è¡¡ä¿è¯

## ğŸ”§ ç¯å¢ƒé…ç½®

### Condaç¯å¢ƒ
```bash
# åˆ›å»ºç¯å¢ƒ
conda create -n one-shot-gee python=3.10 -y
conda activate one-shot-gee

# å®‰è£…ä¾èµ–
pip install pandas numpy matplotlib seaborn transformers accelerate wandb
```

### ä¾èµ–åŒ…çŠ¶æ€
- âœ… PyTorch: å·²å®‰è£…
- âœ… Transformers: å·²å®‰è£…  
- âœ… Accelerate: å·²å®‰è£…
- âœ… WandB: å·²å®‰è£…
- âœ… æ•°æ®å¤„ç†åŒ…: å·²å®‰è£…

## ğŸš€ è¿è¡Œæµç¨‹

### 1. å¿«é€ŸéªŒè¯
```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate one-shot-gee

# è¿è¡Œç»„ä»¶æµ‹è¯•
python test_gee_components.py

# è¿è¡Œè®­ç»ƒé€»è¾‘æµ‹è¯•
python test_gee_training.py
```

### 2. çœŸå®è®­ç»ƒï¼ˆéœ€è¦æ¨¡å‹ï¼‰
```bash
# ä¿®æ”¹æ¨¡å‹è·¯å¾„
vim scripts/train_one_shot_gee.sh

# è¿è¡Œè®­ç»ƒ
bash scripts/train_one_shot_gee.sh
```

### 3. æ•ˆæœè¯„ä¼°
```bash
# è¿è¡Œè¯„ä¼°
bash scripts/evaluate_gee.sh
```

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

åŸºäºGEEè®ºæ–‡çš„ç†è®ºé¢„æœŸï¼š

### æ ¸å¿ƒæŒ‡æ ‡
- **ç†µå·®è·å‡å°‘**: 70-80%
- **æ€§èƒ½ä¿æŒ**: <1% é€€åŒ–
- **è®­ç»ƒæ•ˆç‡**: 10-50æ­¥å®Œæˆ

### ç›‘æ§æŒ‡æ ‡
```
Step X | loss=6.4005 | entropy_gap=0.0161 | H_male=6.3921 | H_female=6.4082
```

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯åš âœ…
1. âœ… ç¯å¢ƒæ­å»ºå®Œæˆ
2. âœ… æ ¸å¿ƒä»£ç å®ç°å®Œæˆ
3. âœ… åŠŸèƒ½æµ‹è¯•é€šè¿‡

### éœ€è¦æ¨¡å‹å
1. **è·å–Qwen2.5-Math-7Bæ¨¡å‹**
   - ä»Hugging Faceä¸‹è½½
   - æˆ–ä½¿ç”¨æœ¬åœ°å·²æœ‰æ¨¡å‹

2. **è¿è¡ŒçœŸå®è®­ç»ƒ**
   ```bash
   # ä¿®æ”¹è„šæœ¬ä¸­çš„æ¨¡å‹è·¯å¾„
   vim scripts/train_one_shot_gee.sh
   # è¿è¡Œè®­ç»ƒ
   bash scripts/train_one_shot_gee.sh
   ```

3. **è¯„ä¼°æ•ˆæœ**
   ```bash
   bash scripts/evaluate_gee.sh
   ```

### æ‰©å±•å¼€å‘ ğŸ”®
1. **å¤šç»„æ‰©å±•**: æ”¯æŒç§æ—ã€å¹´é¾„ç­‰å±æ€§
2. **æ··åˆä»»åŠ¡**: ä¸åŒpromptç±»å‹æƒé‡è°ƒæ•´
3. **é«˜çº§è¯„ä¼°**: é›†æˆæ›´å¤šåè§è¯„ä¼°åŸºå‡†
4. **æ€§èƒ½ä¼˜åŒ–**: æ”¹è¿›è®­ç»ƒæ•ˆç‡

## ğŸ’¡ å…³é”®åˆ›æ–°ç‚¹

### æŠ€æœ¯åˆ›æ–°
1. **æ— ç¼é›†æˆ**: åŸºäºç°æœ‰EMæ¡†æ¶æ‰©å±•
2. **çµæ´»é…ç½®**: æ”¯æŒå¤šç§æŸå¤±å‡½æ•°å’Œå‚æ•°
3. **è‡ªåŠ¨å¹³è¡¡**: æ‰¹å†…æ€§åˆ«åˆ†å¸ƒè‡ªåŠ¨å‡è¡¡
4. **æ¨¡å—åŒ–è®¾è®¡**: ç»„ä»¶å¯ç‹¬ç«‹æµ‹è¯•å’Œæ›¿æ¢

### å®ç”¨æ€§
1. **å³æ’å³ç”¨**: æœ€å°åŒ–å¯¹ç°æœ‰ä»£ç çš„ä¿®æ”¹
2. **å‚æ•°æ•æ„Ÿæ€§**: æä¾›å¤šç§é…ç½®é€‰é¡¹
3. **æ•ˆæœéªŒè¯**: å®Œæ•´çš„æµ‹è¯•å’Œè¯„ä¼°æµç¨‹
4. **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œæ•…éšœæ’é™¤

## ğŸ† é¡¹ç›®ä¼˜åŠ¿

### ç›¸æ¯”åŸå§‹EMçš„æ”¹è¿›
- âœ… **åè§å‡å°‘**: ç›´æ¥é’ˆå¯¹æ€§åˆ«åè§
- âœ… **ç†è®ºæ”¯æ’‘**: åŸºäºGEEæ•°å­¦ç†è®º
- âœ… **å®ç°å®Œæ•´**: ä»è®­ç»ƒåˆ°è¯„ä¼°çš„å®Œæ•´æµç¨‹
- âœ… **æ˜“äºä½¿ç”¨**: ç®€å•çš„å‘½ä»¤è¡Œæ¥å£

### ç›¸æ¯”å…¶ä»–åè§å‡å°‘æ–¹æ³•
- âœ… **æ•ˆç‡æ›´é«˜**: æ— éœ€å¤æ‚çš„RLè®­ç»ƒ
- âœ… **æ•ˆæœæ˜æ˜¾**: ç†è®ºä¸Šå¯è¾¾70-80%å‡å°‘
- âœ… **æ€§èƒ½ä¿æŒ**: å¯¹åŸå§‹ä»»åŠ¡æ€§èƒ½å½±å“æœ€å°
- âœ… **é€šç”¨æ€§å¼º**: å¯æ‰©å±•åˆ°å¤šç§åè§ç±»å‹

## ğŸ‰ æˆåŠŸäº¤ä»˜

### ç¬¬ä¸€é˜¶æ®µç›®æ ‡ âœ…
- [x] å®ç°GEEæ•°æ®å¤„ç†å™¨
- [x] å®ç°GEEæŸå¤±å‡½æ•°  
- [x] ä¿®æ”¹è®­ç»ƒè„šæœ¬æ”¯æŒGEE
- [x] åˆ›å»ºåŸºç¡€è¯„ä¼°åŠŸèƒ½
- [x] å»ºç«‹å®Œæ•´æµ‹è¯•å¥—ä»¶
- [x] éªŒè¯æ ¸å¿ƒåŠŸèƒ½æ­£ç¡®æ€§

### ä»£ç è´¨é‡
- âœ… **å¯è¯»æ€§**: æ¸…æ™°çš„æ³¨é‡Šå’Œæ–‡æ¡£
- âœ… **å¯æµ‹è¯•æ€§**: å®Œæ•´çš„å•å…ƒæµ‹è¯•
- âœ… **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡æ˜“äºæ‰©å±•
- âœ… **å¯ç»´æŠ¤æ€§**: æ ‡å‡†åŒ–çš„ä»£ç ç»“æ„

---

**æ€»ç»“**: One-shot GEEçš„ç¬¬ä¸€é˜¶æ®µæ ¸å¿ƒåŠŸèƒ½å·²æˆåŠŸå®ç°å¹¶é€šè¿‡æµ‹è¯•ã€‚ç³»ç»Ÿå·²å‡†å¤‡å¥½è¿›è¡ŒçœŸå®æ¨¡å‹è®­ç»ƒå’Œæ•ˆæœéªŒè¯ã€‚ä»£ç è´¨é‡é«˜ï¼Œæ–‡æ¡£å®Œå–„ï¼Œå…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§å’Œå®ç”¨æ€§ã€‚ 